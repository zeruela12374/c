<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacita TG - Cadastro</title>
    <link rel="icon" href="/src/imgs/favicon-32x32.png" type="image/x-icon">
    <link rel="stylesheet" href="/src/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=PT+Serif:wght@700&display=swap" rel="stylesheet">
    <style>
        .register-section {
            padding: 4rem 0;
            background: #f8f9fa;
        }

        .register-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .register-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .register-header img {
            height: 120px;
            margin-bottom: 1rem;
        }

        .register-header h2 {
            font-family: 'PT Serif', serif;
            color: #2c5530;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .register-header p {
            color: #6c757d;
            font-size: 1.1rem;
        }

        .register-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: #2c5530;
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Roboto', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4a7c59;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
        }

        .user-type-container {
            display: flex;
            gap: 1rem;
        }

        .user-type-option {
            flex: 1;
            position: relative;
        }

        .user-type-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .user-type-label {
            display: block;
            padding: 1rem;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .user-type-option input[type="radio"]:checked + .user-type-label {
            background: #4a7c59;
            color: white;
            border-color: #4a7c59;
        }

        .user-type-label:hover {
            border-color: #4a7c59;
        }

        .dynamic-fields {
            display: none;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e9ecef;
        }

        .dynamic-fields.active {
            display: flex;
        }

        .register-footer {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e9ecef;
        }

        .register-footer p {
            color: #6c757d;
            margin-bottom: 1rem;
        }

        .register-footer a {
            color: #4a7c59;
            text-decoration: none;
            font-weight: 600;
        }

        .register-footer a:hover {
            text-decoration: underline;
        }

        .btn-primary {
            background: #4a7c59;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #3d5f47;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 124, 89, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Estilos específicos para o modal de confirmação */
        .confirmation-data {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }

        .confirmation-section {
            margin-bottom: 1.5rem;
        }

        .confirmation-section:last-child {
            margin-bottom: 0;
        }

        .confirmation-section h4 {
            color: #2c5530;
            font-size: 1.1rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 0.5rem;
        }

        .confirmation-item {
            display: flex;
            margin-bottom: 0.8rem;
            align-items: flex-start;
        }

        .confirmation-item:last-child {
            margin-bottom: 0;
        }

        .confirmation-label {
            font-weight: 600;
            color: #2c5530;
            min-width: 140px;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .confirmation-value {
            color: #333;
            line-height: 1.5;
            word-break: break-word;
        }

        .confirmation-value.empty {
            color: #6c757d;
            font-style: italic;
        }

        /* Estilos para o spinner de loading */
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-loading {
            display: none;
            align-items: center;
        }

        /* Responsividade para o modal de confirmação */
        @media (max-width: 768px) {
            .confirmation-item {
                flex-direction: column;
            }

            .confirmation-label {
                min-width: auto;
                margin-right: 0;
                margin-bottom: 0.3rem;
            }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8) translateY(-50px);
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-header img {
            height: 80px;
            margin-bottom: 1rem;
        }

        .modal-header h3 {
            font-family: 'PT Serif', serif;
            color: #2c5530;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .modal-header p {
            color: #6c757d;
            font-size: 1rem;
        }

        .modal-content {
            margin-bottom: 2rem;
        }

        .modal-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .modal-info p {
            margin: 0.3rem 0;
            color: #333;
        }

        .modal-info strong {
            color: #2c5530;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .modal-actions .btn {
            flex: 1;
            max-width: 150px;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .register-container {
                margin: 1rem;
                padding: 2rem;
            }

            .user-type-container {
                flex-direction: column;
            }

            .two-columns {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <div class="header-branding">
                        <img src="/src/imgs/insgtg.png" 
                             alt="Símbolo do Exército Brasileiro" 
                             class="logo-military">
                        <div class="brand-title-container">
                            <h1><a href="index.html">Capacita TG</a></h1>
                        </div>
                    </div>
                    
                    <nav class="main-nav">
                        <ul>
                            <li><a href="entrar.html" class="nav-link">Cadastre-se</a></li>
                            <li><a href="index.html#parceiros" class="nav-link">Sobre Nós</a></li>
                            <li><a href="index.html" class="nav-link">Notícias</a></li>
                            <li><a href="index.html#parceira" class="nav-link">Parceiros</a></li>
                            <li><a href="index.html#contato" class="nav-link">Contato</a></li>
                        </ul>
                    </nav>
                </div>
                
                <div class="header-right">
                    <div class="header-actions">
                        <div class="search-container">
                            <input type="search" placeholder="Pesquisar..." aria-label="Pesquisar">
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="register-section">
            <div class="container">
                <div class="register-container">
                    <div class="register-header">
                        <img src="/src/imgs/capacitatg.png" 
                             alt="Logo Capacita TG">
                        <h2>Cadastro de Informações</h2>
                        <p>Preencha seus dados para participar da plataforma Capacita TG</p>
                    </div>

                    <form class="register-form" id="registerForm">
                        <div class="form-group">
                            <label>Tipo de Usuário</label>
                            <div class="user-type-container">
                                <div class="user-type-option">
                                    <input type="radio" id="atirador" name="tipoUsuario" value="atirador" required>
                                    <label for="atirador" class="user-type-label">
                                        Atirador
                                    </label>
                                </div>
                                <div class="user-type-option">
                                    <input type="radio" id="empregador" name="tipoUsuario" value="empregador" required>
                                    <label for="empregador" class="user-type-label">
                                        Empresa
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div id="atiradorFields" class="dynamic-fields">
                            <div class="two-columns">
                                <div class="form-group">
                                    <label for="nomeAtirador">Nome Completo *</label>
                                    <input type="text" id="nomeAtirador" name="nome" placeholder="Digite seu nome completo">
                                </div>
                                <div class="form-group">
                                    <label for="cidadeAtirador">Cidade *</label>
                                    <select id="cidadeAtirador" name="cidade" required>
                                        <option value="">Selecione sua cidade</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="two-columns">
                                <div class="form-group">
                                    <label for="emailAtirador">E-mail *</label>
                                    <input type="email" id="emailAtirador" name="email" placeholder="Digite seu e-mail">
                                </div>
                                <div class="form-group">
                                    <label for="telefoneAtirador">Telefone *</label>
                                    <input type="tel" id="telefoneAtirador" name="telefone" placeholder="(82) 99999-9999">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="habilidadesAtirador">Habilidades *</label>
                                <textarea id="habilidadesAtirador" name="habilidades" placeholder="Descreva suas principais habilidades e competências (ex: Liderança, Disciplina, Trabalho em equipe, etc.)"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="experienciaAtirador">Experiência Profissional</label>
                                <textarea id="experienciaAtirador" name="experiencia" placeholder="Descreva sua experiência profissional relevante (empregos anteriores, projetos, etc.)"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="formacaoAtirador">Formação (Cursos e Certificações)</label>
                                <textarea id="formacaoAtirador" name="formacao" placeholder="Liste sua formação acadêmica, cursos técnicos, certificações e treinamentos relevantes"></textarea>
                            </div>
                        </div>

                        <div id="empresaFields" class="dynamic-fields">
                            <div class="two-columns">
                                <div class="form-group">
                                    <label for="nomeEmpresa">Nome da Empresa *</label>
                                    <input type="text" id="nomeEmpresa" name="nomeEmpresa" placeholder="Digite o nome da empresa">
                                </div>
                                <div class="form-group">
                                    <label for="cidadeEmpresa">Cidade *</label>
                                    <select id="cidadeEmpresa" name="cidade" required>
                                        <option value="">Selecione a cidade da empresa</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="emailEmpresa">E-mail de Contato *</label>
                                <input type="email" id="emailEmpresa" name="email" placeholder="Digite o e-mail de contato da empresa">
                            </div>

                            <div class="form-group">
                                <label for="informacoesEmpresa">Necessidades Específicas</label>
                                <textarea id="informacoesEmpresa" name="informacoes" placeholder="Descreva as necessidades específicas da empresa, tipos de profissionais procurados, requisitos especiais e outras informações relevantes"></textarea>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Cadastrar Informações</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de Confirmação -->
    <div class="modal-overlay" id="confirmationModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/capacitatg.png" 
                     alt="Logo Capacita TG">
                <h3>Revise suas informações</h3>
                <p>Verifique se todos os dados estão corretos antes de confirmar</p>
            </div>
            <div class="modal-content">
                <div class="confirmation-data" id="confirmationData">
                    <!-- Dados serão inseridos dinamicamente aqui -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="editDataBtn">Editar Dados</button>
                <button class="btn btn-success" id="confirmSendBtn">
                    <span class="btn-text">Confirmar e Enviar</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="spinner"></div>
                        Enviando...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/capacitatg.png" 
                     alt="Logo Capacita TG">
                <h3 id="successTitle">Informações Cadastradas!</h3>
                <p id="successMessage">Seus dados foram registrados com sucesso!</p>
            </div>
            <div class="modal-content">
                <div class="modal-info" id="userDataDisplay">
                    </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-success" id="closeSuccessModal">Continuar</button>
            </div>
        </div>
    </div>

    <footer id="contato">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h3>Capacita TG</h3>
                    <p>Sua jornada de sucesso começa aqui.</p>
                    <p>R. Sgt. Benevides Montes, s/n - Primavera, Arapiraca - AL</p>
                </div>
                <div class="footer-col">
                    <h4>Links Rápidos</h4>
                    <ul>
                        <li><a href="entrar.html" class="nav-link">Cadastre-se</a></li>
                        <li><a href="index.html#parceiros" class="nav-link">Sobre Nós</a></li>
                        <li><a href="index.html" class="nav-link">Notícias</a></li>
                        <li><a href="index.html#parceira" class="nav-link">Parceiros</a></li>
                        <li><a href="#contato" class="nav-link">Contato</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contato</h4>
                    <p>Email plataforma: capacitatg@gmail.com</p>
                    <div class="social-links">
                        <a href="https://www.instagram.com/tg07015_exercito/" target="_blank">Instagram</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024-2025 CapacitaTG. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        const CIDADES_TG = Object.freeze({
            'arapiraca': { nome: 'Arapiraca', tg: '07-015' },
            'penedo': { nome: 'Penedo', tg: '07-008' },
            'sao-jose-da-laje': { nome: 'São José da Laje', tg: '07-009' },
            'palmeira-dos-indios': { nome: 'Palmeira dos Índios', tg: '07-007' },
            'teotonio-vilela': { nome: 'Teotônio Vilela', tg: '07-022' },
            'maceio': { nome: 'Maceió', tg: '07-XXX' }
        });

        const LINKS_POR_CIDADE = new Map([
            ['arapiraca', {
                googleFormsAtirador: '1FAIpQLSfLrW0ZHVQ4c2ZL2NasplqpBVXoi6OBjEerAKW892CqDCOwyg',
                googleFormsEmpresa: '1FAIpQLSdYlATmRxlXPP4J2l95JkV-rUtq7Pz0U0IQy81RC0dOyazm4w'
            }],
            ['penedo', {
                googleFormsAtirador: '1FAIpQLSd5u4S-0P8iDkthJ_MvIIpmPxuJMn1vfIptZ0sRB3XuZK4pFQ',
                googleFormsEmpresa: '1FAIpQLSdaWIHXqDvGTrcdZO7maozDXZMY5uyuQ4kUBvDjJVAyWYq3fQ'
            }],
            ['sao-jose-da-laje', {
                googleFormsAtirador: '1FAIpQLSfwmH8p16pMhpRDG293k30ZEcZRX8lrhQebLmaCgUD7KlndcA',
                googleFormsEmpresa: '1FAIpQLSdsLt2uncwU8kMVXOHPZiQXPior0jsuhVWqzuPtF-E9rRlfGA'
            }],
            ['palmeira-dos-indios', {
                googleFormsAtirador: '1FAIpQLSehnl4mE8IwGdAcyjO7B7OJnsEL8_D7wx8c02svJKPOOr8yhA',
                googleFormsEmpresa: '1FAIpQLScD9-1RBbzzvZ-WHnMA03Eh5LB6SXfQiDO1Bi6JKBWHP4ZloA'
            }],
            ['teotonio-vilela', {
                googleFormsAtirador: '1FAIpQLScGcDsOsjuQDZP2hgF1NbRNFEfCBkgcSn-jsmO-cVYLms3ijw',
                googleFormsEmpresa: '1FAIpQLSdvs0CCRAF0bBEmG9BTu9ZQL_QPNH35dkSZ_CZOrf9nOpEIYw'
            }],
            ['maceio', {
                googleFormsAtirador: '1FAIpQLSd8zGOHszNQbbUNoXYYaOBuqHsEstf5iCQs8FaBC3RkpCYIJg',
                googleFormsEmpresa: '1FAIpQLSfLvlE4GknS15UEl6BHCbFc6sCye0E6VpOyMZ5oNVXrakv49Q'
            }]
        ]);

        const GOOGLE_FORMS_ENTRIES = Object.freeze({
            'arapiraca': {
                atirador: {
                    nome: 'entry.853041105',
                    cidade: 'entry.1655651544',
                    email: 'entry.1163678157',
                    telefone: 'entry.1064615820',
                    habilidades: 'entry.886074616',
                    experiencia: 'entry.751681135',
                    formacao: 'entry.839720216'
                },
                empregador: {
                    nomeEmpresa: 'entry.651591594',
                    cidade: 'entry.1127503044',
                    email: 'entry.126672336',
                    informacoes: 'entry.1699463522'
                }
            },
            'penedo': {
                atirador: {
                    nome: 'entry.1206068341',
                    cidade: 'entry.1332917444',
                    email: 'entry.1698248790',
                    telefone: 'entry.811954895',
                    habilidades: 'entry.1753535137',
                    experiencia: 'entry.760431858',
                    formacao: 'entry.719043884'
                },
                empregador: {
                    nomeEmpresa: 'entry.1580825317',
                    cidade: 'entry.173911948',
                    email: 'entry.1485240650',
                    informacoes: 'entry.2099592061'
                }
            },
            'sao-jose-da-laje': {
                atirador: {
                    nome: 'entry.1899852279',
                    cidade: 'entry.335067575',
                    email: 'entry.399460357',
                    telefone: 'entry.635521259',
                    habilidades: 'entry.1937156146',
                    experiencia: 'entry.569494459',
                    formacao: 'entry.63562277'
                },
                empregador: {
                    nomeEmpresa: 'entry.1775912737',
                    cidade: 'entry.412601301',
                    email: 'entry.715712106',
                    informacoes: 'entry.325563878'
                }
            },
            'palmeira-dos-indios': {
                atirador: {
                    nome: 'entry.1636878027',
                    cidade: 'entry.1088563717',
                    email: 'entry.725672814',
                    telefone: 'entry.1102498617',
                    habilidades: 'entry.1234823634',
                    experiencia: 'entry.1598595418',
                    formacao: 'entry.649280654'
                },
                empregador: {
                    nomeEmpresa: 'entry.1911710254',
                    cidade: 'entry.2005794250',
                    email: 'entry.1576464807',
                    informacoes: 'entry.600567061'
                }
            },
            'teotonio-vilela': {
                atirador: {
                    nome: 'entry.253685633',
                    cidade: 'entry.82920502',
                    email: 'entry.2136174470',
                    telefone: 'entry.1059105440',
                    habilidades: 'entry.30521210',
                    experiencia: 'entry.2097377194',
                    formacao: 'entry.662991665'
                },
                empregador: {
                    nomeEmpresa: 'entry.1716837033',
                    cidade: 'entry.1324672214',
                    email: 'entry.1981471285',
                    informacoes: 'entry.333904842'
                }
            },
            'maceio': {
                atirador: {
                    nome: 'entry.514042188',
                    cidade: 'entry.693758517',
                    email: 'entry.2133501356',
                    telefone: 'entry.1671026996',
                    habilidades: 'entry.1661106719',
                    experiencia: 'entry.1117175532',
                    formacao: 'entry.702634501'
                },
                empregador: {
                    nomeEmpresa: 'entry.1411481709',
                    cidade: 'entry.1601507226',
                    email: 'entry.390590409',
                    informacoes: 'entry.391909014'
                }
            }
        });

        class CapacitaTGManager {
            constructor() {
                this.currentCity = null;
                this.currentUserType = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.populateCitySelects();
                this.setupFormValidation();
            }

            populateCitySelects() {
                const selects = ['cidadeAtirador', 'cidadeEmpresa'];
                
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (!select) return;

                    select.innerHTML = '<option value="">Selecione a cidade</option>';
                    const fragment = document.createDocumentFragment();
                    
                    Object.entries(CIDADES_TG).forEach(([key, { nome, tg }]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = nome;
                        option.dataset.tg = tg;
                        fragment.appendChild(option);
                    });

                    select.appendChild(fragment);
                });
            }

            setupEventListeners() {
                document.addEventListener('change', this.handleFormChanges.bind(this));
                document.addEventListener('submit', this.handleFormSubmit.bind(this));
                document.addEventListener('input', this.handleInputEvents.bind(this));
                document.addEventListener('click', this.handleClickEvents.bind(this));
            }

            handleFormChanges(event) {
                const { target } = event;
                
                switch (target.name) {
                    case 'tipoUsuario':
                        this.handleUserTypeChange(target.value);
                        break;
                    case 'cidade':
                        this.handleCityChange(target.value);
                        break;
                }
            }

            handleUserTypeChange(userType) {
                this.currentUserType = userType;
                this.toggleUserTypeFields(userType);
                this.setRequiredFields(userType);
            }

            handleCityChange(cityKey) {
                this.currentCity = cityKey;
            }

            handleInputEvents(event) {
                const { target } = event;
                
                if (target.id === 'telefoneAtirador') {
                    this.applyPhoneMask(target);
                }
            }

            handleClickEvents(event) {
                const { target } = event;
                
                if (target.classList.contains('modal-overlay')) {
                    this.hideModal(target.id);
                } else if (target.id === 'closeSuccessModal') {
                    this.hideModal('successModal');
                }
            }

            applyPhoneMask(input) {
                const value = input.value.replace(/\D/g, '');
                const formattedValue = value.length <= 11 
                    ? value.replace(/^(\d{2})(\d{5})(\d{4})/, '($1) $2-$3')
                    : value.replace(/^(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                
                input.value = formattedValue;
            }

            toggleUserTypeFields(userType) {
                const fieldsMap = {
                    'atirador': 'atiradorFields',
                    'empregador': 'empresaFields'
                };

                Object.values(fieldsMap).forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.classList.remove('active');
                });

                const targetField = document.getElementById(fieldsMap[userType]);
                if (targetField) {
                    setTimeout(() => targetField.classList.add('active'), 50);
                }
            }

            setRequiredFields(userType) {
                document.querySelectorAll('.dynamic-fields input, .dynamic-fields textarea, .dynamic-fields select')
                    .forEach(field => field.removeAttribute('required'));

                const requiredFields = {
                    'atirador': ['nomeAtirador', 'cidadeAtirador', 'emailAtirador', 'telefoneAtirador', 'habilidadesAtirador'],
                    'empregador': ['nomeEmpresa', 'cidadeEmpresa', 'emailEmpresa']
                };

                requiredFields[userType]?.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.setAttribute('required', '');
                });
            }

            setupFormValidation() {
                const form = document.getElementById('registerForm');
                if (!form) return;

                form.addEventListener('invalid', (event) => {
                    event.preventDefault();
                    this.showValidationError(event.target);
                }, true);
            }

            showValidationError(field) {
                field.focus();
                field.classList.add('error');
                setTimeout(() => field.classList.remove('error'), 3000);
            }

            handleFormSubmit(event) {
                if (event.target.id === 'registerForm') {
                    event.preventDefault();
                    this.processFormSubmission();
                }
            }

            processFormSubmission() {
                if (!this.validateForm()) return;

                const userData = this.collectUserData();
                this.showConfirmationModal(userData);
            }

            showConfirmationModal(userData) {
                const confirmationData = document.getElementById('confirmationData');
                confirmationData.innerHTML = this.buildConfirmationHTML(userData);
                
                // Armazenar dados temporariamente para envio posterior
                this.tempUserData = userData;
                
                this.showModal('confirmationModal');
            }

            buildConfirmationHTML(userData) {
                const isAtirador = userData.tipoUsuario === 'atirador';
                
                if (isAtirador) {
                    return `
                        <div class="confirmation-section">
                            <h4>Dados Pessoais</h4>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Nome Completo:</span>
                                <span class="confirmation-value">${userData.nome}</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Cidade:</span>
                                <span class="confirmation-value">${userData.cidade}</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-label">E-mail:</span>
                                <span class="confirmation-value">${userData.email}</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Telefone:</span>
                                <span class="confirmation-value">${userData.telefone}</span>
                            </div>
                        </div>
                        <div class="confirmation-section">
                            <h4>Informações Profissionais</h4>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Habilidades:</span>
                                <span class="confirmation-value">${userData.habilidades}</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Experiência:</span>
                                <span class="confirmation-value ${!userData.experiencia ? 'empty' : ''}">${userData.experiencia || 'Não informado'}</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Formação:</span>
                                <span class="confirmation-value ${!userData.formacao ? 'empty' : ''}">${userData.formacao || 'Não informado'}</span>
                            </div>
                        </div>
                        <div class="confirmation-section">
                            <h4>Tipo de Usuário</h4>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Categoria:</span>
                                <span class="confirmation-value">Atirador</span>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="confirmation-section">
                            <h4>Dados da Empresa</h4>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Nome da Empresa:</span>
                                <span class="confirmation-value">${userData.nomeEmpresa}</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Cidade:</span>
                                <span class="confirmation-value">${userData.cidade}</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-label">E-mail:</span>
                                <span class="confirmation-value">${userData.email}</span>
                            </div>
                        </div>
                        <div class="confirmation-section">
                            <h4>Necessidades da Empresa</h4>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Informações:</span>
                                <span class="confirmation-value ${!userData.informacoes ? 'empty' : ''}">${userData.informacoes || 'Não informado'}</span>
                            </div>
                        </div>
                        <div class="confirmation-section">
                            <h4>Tipo de Usuário</h4>
                            <div class="confirmation-item">
                                <span class="confirmation-label">Categoria:</span>
                                <span class="confirmation-value">Empresa</span>
                            </div>
                        </div>
                    `;
                }
            }

            validateForm() {
                const form = document.getElementById('registerForm');
                const isValid = form.checkValidity();
                
                if (!isValid) {
                    form.reportValidity();
                    return false;
                }

                if (!this.currentCity) {
                    alert('Por favor, selecione uma cidade válida.');
                    return false;
                }

                return true;
            }

            collectUserData() {
                const userType = this.currentUserType;
                const cityData = CIDADES_TG[this.currentCity];
                
                const baseData = {
                    tipoUsuario: userType,
                    cidade: `${cityData.nome}`,
                    cidadeKey: this.currentCity,
                    tg: cityData.tg,
                    cadastroDate: new Date().toISOString()
                };

                if (userType === 'atirador') {
                    return {
                        ...baseData,
                        ...this.getAtiradorData()
                    };
                } else {
                    return {
                        ...baseData,
                        ...this.getEmpresaData()
                    };
                }
            }

            getAtiradorData() {
                const fields = ['nomeAtirador', 'emailAtirador', 'telefoneAtirador', 'habilidadesAtirador', 'experienciaAtirador', 'formacaoAtirador'];
                const data = {};

                fields.forEach(field => {
                    const element = document.getElementById(field);
                    if (element) {
                        const key = field.replace('Atirador', '');
                        data[key] = element.value.trim();
                    }
                });

                return data;
            }

            getEmpresaData() {
                const fieldMap = {
                    'nomeEmpresa': 'nomeEmpresa',
                    'emailEmpresa': 'email',
                    'informacoesEmpresa': 'informacoes'
                };

                const data = {};
                Object.entries(fieldMap).forEach(([elementId, dataKey]) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        data[dataKey] = element.value.trim();
                    }
                });

                return data;
            }

            submitToGoogleForms(userData, showLoadingOnButton = false) {
                const cityLinks = LINKS_POR_CIDADE.get(userData.cidadeKey);
                if (!cityLinks) {
                    alert('Erro: Configuração não encontrada para a cidade selecionada.');
                    return;
                }

                const formId = userData.tipoUsuario === 'atirador' 
                    ? cityLinks.googleFormsAtirador 
                    : cityLinks.googleFormsEmpresa;

                const formUrl = `https://docs.google.com/forms/d/e/${formId}/formResponse`;
                const formData = this.buildFormData(userData);

                if (showLoadingOnButton) {
                    this.sendToGoogleFormsWithLoading(formUrl, formData, userData);
                } else {
                    this.sendToGoogleForms(formUrl, formData, userData);
                }
            }

            buildFormData(userData) {
                const formData = new FormData();
                const cityEntries = GOOGLE_FORMS_ENTRIES[userData.cidadeKey];
                
                if (!cityEntries) {
                    alert('Erro: Configuração não encontrada para a cidade selecionada.');
                    return formData;
                }
                
                const entries = cityEntries[userData.tipoUsuario];
                
                if (!entries) {
                    alert('Erro: Configuração não encontrada para o tipo de usuário selecionado.');
                    return formData;
                }
                
                Object.entries(entries).forEach(([key, entryId]) => {
                    const value = userData[key] || '';
                    formData.append(entryId, value);
                });

                return formData;
            }

            async sendToGoogleFormsWithLoading(url, formData, userData) {
                const confirmBtn = document.getElementById('confirmSendBtn');
                const btnText = confirmBtn.querySelector('.btn-text');
                const btnLoading = confirmBtn.querySelector('.btn-loading');
                
                // Mostrar loading
                btnText.style.display = 'none';
                btnLoading.style.display = 'flex';
                confirmBtn.disabled = true;
                
                try {
                    await fetch(url, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });
                } catch (error) {
                    console.error('Erro no envio:', error);
                } finally {
                    // Restaurar botão
                    btnText.style.display = 'block';
                    btnLoading.style.display = 'none';
                    confirmBtn.disabled = false;
                    
                    // Fechar modal de confirmação e mostrar sucesso
                    this.hideModal('confirmationModal');
                    this.showSuccessModal(userData);
                    this.clearForm();
                }
            }

            async sendToGoogleForms(url, formData, userData) {
                try {
                    await fetch(url, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });
                } catch (error) {
                    
                } finally {
                    this.showSuccessModal(userData);
                    this.clearForm();
                }
            }

            clearForm() {
                const form = document.getElementById('registerForm');
                if (form) {
                    form.reset();
                    this.currentCity = null;
                    this.currentUserType = null;
                    
                    ['atiradorFields', 'empresaFields'].forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) field.classList.remove('active');
                    });
                }
            }

            showSuccessModal(userData) {
                const modalInfo = this.buildSuccessModalContent(userData);
                const userDataDisplay = document.getElementById('userDataDisplay');
                const successMessage = document.getElementById('successMessage');

                if (userDataDisplay) userDataDisplay.innerHTML = modalInfo.dataHTML;
                if (successMessage) successMessage.textContent = modalInfo.message;

                this.showModal('successModal');
            }

            buildSuccessModalContent(userData) {
                const isAtirador = userData.tipoUsuario === 'atirador';
                
                const dataHTML = isAtirador ? `
                    <p><strong>Nome:</strong> ${userData.nome}</p>
                    <p><strong>Cidade:</strong> ${userData.cidade}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Telefone:</strong> ${userData.telefone}</p>
                    <p><strong>Tipo:</strong> Atirador</p>
                ` : `
                    <p><strong>Empresa:</strong> ${userData.nomeEmpresa}</p>
                    <p><strong>Cidade:</strong> ${userData.cidade}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Tipo:</strong> Empresa</p>
                `;

                const message = isAtirador
                    ? 'Suas informações foram enviadas com sucesso para o sistema Capacita TG! Você foi cadastrado em nossa base de atiradores.'
                    : 'Suas informações foram enviadas com sucesso para o sistema Capacita TG! Sua empresa foi cadastrada em nossa base de parceiros.';

                return { dataHTML, message };
            }

            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const manager = new CapacitaTGManager();
            
            // Event listeners para o modal de confirmação
            document.getElementById('editDataBtn').addEventListener('click', function() {
                manager.hideModal('confirmationModal');
            });
            
            document.getElementById('confirmSendBtn').addEventListener('click', function() {
                if (manager.tempUserData) {
                    manager.submitToGoogleForms(manager.tempUserData, true);
                }
            });
            
            // Fechar modal de confirmação clicando no overlay
            document.getElementById('confirmationModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    manager.hideModal('confirmationModal');
                }
            });
        });

        window.CapacitaTG = {
            getCityTG: (cityKey) => CIDADES_TG[cityKey],
            getCityLinks: (cityKey) => LINKS_POR_CIDADE.get(cityKey),
            getAllCities: () => Object.keys(CIDADES_TG)
        };
    </script>
</body>
</html>